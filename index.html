<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FX ロット数計算機</title>
<style>
  body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", Meiryo, sans-serif; margin: 24px; background: #fafafa; }
  h1 { font-size: 1.3rem; margin-bottom: 8px; text-align:center; }
  .pill { display:inline-block; padding:2px 8px; border-radius:999px; background:#e3f2fd; margin-left:6px; font-size:.8rem; color:#1565c0; }
  .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin-bottom: 12px; background:#fff; }
  label { display:block; font-size: 0.95rem; margin: 8px 0 4px; }
  input { width: 100%; padding: 10px; font-size: 1rem; border: 1px solid #ccc; border-radius: 8px; box-sizing:border-box; }
  .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .btn { display:block; width:100%; padding: 12px; font-size: 1rem; border: none; border-radius: 10px; background: #1a73e8; color: #fff; margin-top: 12px; }
  .out { font-size: 1.1rem; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }
  .muted { color: #666; font-size: .9rem; }
  hr { border: none; border-top: 1px solid #e0e0e0; margin: 10px 0; }
</style>
</head>
<body>
  <h1>FX ロット数計算機 <span class="pill">オフライン対応</span></h1>

  <div class="card">
    <div class="row">
      <div>
        <label>① 総資金額 <small>(口座通貨建て)</small></label>
        <input id="balance" type="number" inputmode="decimal" placeholder="例: 1000000" value="1000000">
      </div>
      <div>
        <label>④ 許容リスク（%）</label>
        <input id="riskPct" type="number" inputmode="decimal" placeholder="例: 0.5" value="0.5" step="0.01">
      </div>
    </div>

    <div class="row">
      <div>
        <label>② エントリーレート</label>
        <input id="entry" type="number" inputmode="decimal" placeholder="例: 150.250" step="0.00001">
      </div>
      <div>
        <label>③ ストップロスレート</label>
        <input id="stop" type="number" inputmode="decimal" placeholder="例: 149.950" step="0.00001">
      </div>
    </div>

    <button class="btn" onclick="calc()">計算する</button>
  </div>

  <div class="card out" id="result" aria-live="polite">
    ここに結果が表示されます。
  </div>

  <div class="muted">
    <p>計算式：</p>
    <ul>
      <li>許容損失額 = 総資金額 × (許容リスク% ÷ 100)</li>
      <li>ストップ幅[pips] = |エントリー − ストップ| ÷ 0.01（JPYペア固定）</li>
      <li>1ロットのピップ値 = 100000 × 0.01 × 1 = 1,000（口座通貨）</li>
      <li>推奨ロット = 許容損失額 ÷ (ストップ幅 × 1,000)</li>
    </ul>
  </div>

<script>
function fmt(n) {
  if (!isFinite(n)) return '-';
  return new Intl.NumberFormat('ja-JP', { maximumFractionDigits: 4 }).format(n);
}

function calc() {
  // 入力値
  const balance = parseFloat(document.getElementById('balance').value);
  const riskPct = parseFloat(document.getElementById('riskPct').value);
  const entry   = parseFloat(document.getElementById('entry').value);
  const stop    = parseFloat(document.getElementById('stop').value);

  // 固定値（非表示項目）
  const pipSize = 0.01;       // JPYペア
  const contractSize = 100000; // 1ロット = 100,000 通貨
  const convRate = 1;          // 見積通貨→口座通貨

  if ([balance, riskPct, entry, stop].some(v => !isFinite(v))) {
    document.getElementById('result').innerHTML = "未入力の項目があります。";
    return;
  }

  // 計算
  const riskAmt = balance * (riskPct / 100);
  const stopPips = Math.abs(entry - stop) / pipSize;
  const pipValPerLot = (contractSize * pipSize) * convRate; // = 1,000
  const lots = riskAmt / (stopPips * pipValPerLot);
  const perPip = pipValPerLot * lots;

  // 出力
  const res = `
    <div><b>推奨ロット：</b> <span class="mono">${fmt(lots)}</span> ロット</div>
    <hr>
    <div>許容損失額：${fmt(riskAmt)}</div>
    <div>ストップ幅：${fmt(stopPips)} pips</div>
    <div>1ロットのピップ値：${fmt(pipValPerLot)}</div>
    <div>保有あたりのピップ値：${fmt(perPip)} / pip</div>
  `;
  document.getElementById('result').innerHTML = res;
}
</script>
</body>
</html>